void LeadOwnerUpdate(string payload)
{
// -----------------------------------------------------------------------------------------------
// This function executes when Zoho SalesIQ sends webhook when ..
// .. a chat has been created. This will then pull the operator and ..
// .. update the generated lead record to sync the operator as Lead Owner.
// -----------------------------------------------------------------------------------------------
// Get Payload Data
entityData = payload.get("entity");
convfId = entityData.get("id");
visitorName = entityData.get("visitor").get("name");
leadSource = "Facebook";
fetchConvf = invokeurl
[
	url :"https://salesiq.zoho.com/api/v2/dmcihomes5226/conversations/" + convfId
	type :GET
	connection:"salesiq_connections"
];
routedUserId = fetchConvf.get("data").get("routed_users").get(0);
// -----------------------------------------------------------------------------------------------
// Get Operator
// -----------------------------------------------------------------------------------------------
fetchOperator = invokeurl
[
	url :"https://salesiq.zoho.com/api/v2/dmcihomes5226/operators/" + routedUserId
	type :GET
	connection:"salesiq_connections"
];
operatorEmail = fetchOperator.get("data").get("email_id");
// -----------------------------------------------------------------------------------------------
// Pull User Data in CRM
// -----------------------------------------------------------------------------------------------
userData = zoho.crm.searchRecords("users","(email:equals:" + operatorEmail + ")");
userCrmId = userData.get("users").get(0).get("id");
// -----------------------------------------------------------------------------------------------
// Pull Lead Record in CRM
// -----------------------------------------------------------------------------------------------
querySelect = "select id, Full_Name, Lead_Status, Created_Time from Leads ";
// queryWhere = "where Full_Name = '" + visitorName + "' and Lead_Status ='New Prospect'";
queryWhere = "where (((Full_Name = '" + visitorName + "') and (Lead_Source ='" + leadSource + "')) and Lead_Status ='New Prospect')";
queryLimit = " limit 200";
query = querySelect + queryWhere + queryLimit;
queryMap = Map();
queryMap.put("select_query",query);
searchLeadsMetaData = invokeurl
[
	url :"https://www.zohoapis.com/crm/v7/coql"
	type :POST
	parameters:queryMap.toString()
	connection:"flow_to_crm_connections"
];
if(searchLeadsMetaData != "")
{
	leadId = searchLeadsMetaData.get("data").get(0).get("id");
	// -----------------------------------------------------------------------------------------------
	// Update Lead Owner
	// -----------------------------------------------------------------------------------------------
	param = Map();
	param.put("Owner",userCrmId);
	updateLeadRecord = zoho.crm.updateRecord("Leads",leadId,param,{"trigger":{"workflow"}});
	info updateLeadRecord;
}
else
{
	info "No lead captured.";
}
// END
// -----------------------------------------------------------------------------------------------
}